# 2020-06-12-TIL

## 오늘 할 일

- [ ] Jenkins AWS CodeDeploy 연동
- [ ] 스프링 Data JPA 강의 듣기
- [ ] API 구현하기
- [ ] C2 Model 데모시간 때 그리기
- [ ] 데모 준비하기
- [ ] 알고리즘 문제 풀기
- [ ] Brian 과제 Things에 추가하기
- [ ] 트리 자료구조 공부하기

## Spring Data JPA 강의

- Hibernate, JPA ⇒ ORM 에 대한 학습: ORM이 어떠한 문제를 해결하고자 하는 것인지 이해
- JPA의 고유한 특징들을 이해
- Spring Data JPA의 학습

왜? 이렇게 진행하는가?

- ORM에 대해서 흔히 가지는 오해: 단순히 객체를 테이블로 매핑해서 어떻게 쿼리를 날릴 것이냐?
  - 이것은 ORM이 지원하는 기능 중 가장 일부
- ORM이 제공하는 가치가 숨어있음. (널리 알려져있지 않음): 핵심적인 가치에 대한 이해가 필요.
- JPA, Hibernate가 가지고 있는 특징을 이해해야 비효율적인 쿼리가 발생하는 것을 방지하고 해결할 수 있음.
- 구체적인 내용은 다 다루지 않음. 이 강의는 Spring Data JPA를 이해하는데 지장이 되지 않는 정도까지만 강의할 예정
- Spring Data JPA를 처음 쓰는 사람에게 적합한 강좌.

## Jenkins AWS CodeDeploy 연동

### Ubuntu Server용 CodeDeploy Agent 설치

[Ubuntu Server용 CodeDeploy 에이전트 설치 또는 다시 설치](https://docs.aws.amazon.com/ko_kr/codedeploy/latest/userguide/codedeploy-agent-operations-install-ubuntu.html)

[리전별 리소스 키트 버킷 이름](https://docs.aws.amazon.com/ko_kr/codedeploy/latest/userguide/resource-kit.html#resource-kit-bucket-names)

```shell
sudo apt install ruby -y
sudo apt install wget -y
cd /home/ubuntu
# 서울리전 기준
wget https://aws-codedeploy-ap-northeast-2.s3.ap-northeast-2.amazonaws.com/latest/install
chmod +x ./install
sudo ./install auto
```

잘 안뜨는 경우가 많다.

서비스 상태 확인

`sudo service codedeploy-agent status`

서비스 재시작은 `restart`

꺼져있는 경우는 이렇게 나옴

```
● codedeploy-agent.service - LSB: AWS CodeDeploy Host Agent
   Loaded: loaded (/etc/init.d/codedeploy-agent; generated)
   Active: inactive (dead)
     Docs: man:systemd-sysv-generator(8)
```

켜져있는 경우는 이렇게 나옴

```
● codedeploy-agent.service - LSB: AWS CodeDeploy Host Agent
   Loaded: loaded (/etc/init.d/codedeploy-agent; generated)
   Active: active (exited) since Fri 2020-06-12 01:57:09 UTC; 3s ago
     Docs: man:systemd-sysv-generator(8)
  Process: 31065 ExecStart=/etc/init.d/codedeploy-agent start (code=exited, status=0/SUCCESS)

Jun 12 01:57:08 ip-10-0-1-61 systemd[1]: Starting LSB: AWS CodeDeploy Host Agent...
Jun 12 01:57:09 ip-10-0-1-61 codedeploy-agent[31065]: Starting codedeploy-agent:
Jun 12 01:57:09 ip-10-0-1-61 systemd[1]: Started LSB: AWS CodeDeploy Host Agent.
```

### IAM Role 만들기

EC2에서 CodeDeploy, S3에 접근 가능한 role

CodeDeploy의 role

EC2 인스턴스와 CodeDeploy에 생성한 role을 부여해주면 된다.

### CodeDeploy만들기

만들고, 배포그룹 설정

- 아까 만든 role 부여
- 현재 위치
- Amazon EC2 인스턴스 선택
- 배포구성은 AllAtOnce
- 로드밸런싱 Off

