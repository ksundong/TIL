# 2020-06-03-TIL

## 오늘 할 일

- [x] MySQL 공간 데이터 검색 공부
- [x] CI/CD 개선 및 FE CI/CD 구현
- [ ] 백기선님 강의 듣기
- [ ] Bcrypt 의존성 추가 및 암호화 적용
- [x] MySQL 공간 데이터 근처 검색기능 추가
- [x] 스크럼

## MySQL 공간 데이터 근처 검색하기

1. 공간 데이터는 Sptial Data Type으로 저장해야한다.
   [참고](https://dev.mysql.com/doc/refman/5.7/en/spatial-types.html)
   `POINT` 형으로 위도 경도를 저장했다. `POINT(위도, 경도)`
2. 공간 데이터 근처 검색을 하려면, `SPATIAL INDEX`를 생성해야한다.
3. `ST_DISTANCE_SPHERE()`를 이용하면, 구체 위에서 두 점 사이의 최단 거리를 meter 단위로 변환해서 준다.

https://purumae.tistory.com/198

여기를 참고해서 만들었는데 잘된다!!

## 스크럼

- 어제 한 일
    - 상세화면 API 개발(충돌나는 부분도 해결)
    - 예약관련 API 개발(예약 조회, 예약 취소)
    - 2주차 Code Review 요청 보내기
    - 운동하기
- 오늘 할 일
    - MySQL 공간 데이터 검색 및 공부
    - MySQL 공간 데이터 근처 검색기능 추가
    - CI/CD 개선 및 FE CI/CD 구현
    - Bcrypt 의존성 추가 및 암호화 적용
- 컨디션
    - 학원에 안나가니까 더 좋은 느낌인 것 같네요..!

## MySQL 저장 프로시저

MySQL에서 약간 함수처럼 사용할 수 있는 것

보통 여러 쿼리를 한 번에 실행시킬 때 필요하다.

디버깅이 더럽게 어렵다.

[참고](https://recoveryman.tistory.com/186)

구분문자(DELIMITER) 변경은 거의 필수적임

왜 변경하냐면 중간에 작성하는 명령들이 실행되면 안되기 때문

```sql
DELIMITER //
CREATE PROCEDURE 프로시저명(매개변수 타입)
BEGIN
  명령문
END //

DELIMITER ;
```

와 같은 식으로 작성해줄 수 있다.

타입은 그냥 적으면 기본형으로 들어가서 변형이 필요한 경우 작성해준다.

`DECIMAL` → `DECIMAL(17,3)` 과 같은 식으로...

`CALL 프로시저명` 으로 호출할 수 있다.

내부에서 `DECLARE` 로 변수 선언을 하거나

`SET` 으로 변수 선언과 동시에 값을 할당 해줄 수 있다.

**저장 함수**라는 것도 있는데 저장 프로시저와의 차이는 값을 반환한다는 것이다.

그래서 얘는 `FUNCTION` 키워드를 사용하고 뒤에 `RETURNS 반환타입` 을 적어준다. 

## Brian의 조언

1. RDBMS에서 Geo Query는 비추천 ⇒ 왜? 인지는 공부를 해보자.
   검색엔진(Elasticsearch)의 geo distance query를 사용해보자.
   일단 호눅스가 내준 옵션과제는 본문 자연어 검색이 옵션

2. 쿼리 안에서 변수 SET을 해서 쓰는 것도 지양하는 추세.
   왜냐하면 리팩토링, 개발시에 매우 고통받기 때문, 디버깅도 힘듦.
   Stored Procedure도 마찬가지임.
   왜냐하면 큰 회사에서는 Stored Procedure를 만들고 쿼리를 짜서 애플리케이션을 개발하는데에 상급자의 결재와 승인이 필요하기 때문임.
   즉, 개발속도가 느려지게 된다.

   그래서 요즘엔 가급적 애플리케이션의 책임을 늘리는 쪽으로 바뀌고 있음.
   조직적인 이슈 외에도, 확장성으로도 더 유의미한 차이가 있음.
   RDBMS는 수평확장이 매우 어렵기 때문에 수평확장이 쉬운 웹서버에 더 책임을 주는 추세.

3. RDBMS에서 Geo Query를 비추천 하는 이유
   ⇒ RDBMS가 잘하는 일이 있고 못하는 일이 있는데, 두 가지의 차이를 조사해보기.
   RDBMS가 잘하는 일을 더 잘하게 하고, 어려워하는 일은 애플리케이션이나 검색엔진에게 위임하는 것이 요즘의 트렌드.
   따라서 이를 구분하는 나름의 기준이 있으면 좋음.
   **Brian에게 그 기준을 보여주고, 호눅스에게도 검사를 받아보세요.**
   잘 정리해서 발표를 해보자.

[엘라스틱서치 공부](https://velog.io/@jakeseo_me/엘라스틱서치-알아보기-1-엘라스틱서치는-검색엔진이다)

## 오늘의 회고

- 잘한점
  - 꽤나 큼직큼직한 분량을 다 끝냈다.
  - 여러 공부할 거리들을 많이 구했다.
  - 운동을 했다.
  - 적당히 쉬면서 해도 거의 다했다.
  - FE도 CI/CD를 구현했다.
- 못한점
  - Bcrypt 암호화를 안했다.
  - 공부한 내용을 잘 정리하지 못한 것 같다.

## 내일 할 일

- [ ] 스크럼
- [ ] Bcrypt 의존성 추가 및 암호화 적용
- [ ] Admin Tool 제작
- [ ] 테스트 코드 작성
- [ ] Elastic Search 공부
- [ ] Spring 백기선님 강의 듣기
- [ ] 운동하기
- [ ] 써니 만나기
- [ ] 맥 수리 맡기기

