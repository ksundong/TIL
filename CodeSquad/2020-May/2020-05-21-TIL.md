# 2020-05-21-TIL

## 오늘 할 일

- [ ] GitHub Actions 적용해보기
- [ ] Zello랑 예전페이지 구현방식과 현재페이지 구현방식중 선택하기
- [ ] 기능흐름도 만들기 Level3 ⇒ Story
- [ ] 상세 기능(task) 목록 만들기(테스트 시나리오도....가능할까...)
- [ ] Mock API 만들기(페어 프로그래밍)

## GitHub Actions 정리

github actions에서 push를 감지해서 codedeploy를 이용해 ec2에 배포를 한다.

### EC2 스펙

- Ubuntu 18.04
- t2.micro(Free Tier)
- 한국 리전

### EC2 설정

```sh
sudo apt update
sudo apt install openjdk-8 -y
sudo apt install ruby -y
sudo apt install wget -y
cd /home/ubuntu
wget https://aws-codedeploy-ap-northeast-2.s3.ap-northeast-2.amazonaws.com/latest/install
# 리전이 다른경우: https://docs.aws.amazon.com/ko_kr/codedeploy/latest/userguide/resource-kit.html#resource-kit-bucket-names 참조
chmod +x ./install
sudo ./install auto
# 설치확인
sudo service codedeploy-agent status
```

[AWS Ubuntu Server에 CodeDeploy Agent 설치](https://docs.aws.amazon.com/ko_kr/codedeploy/latest/userguide/codedeploy-agent-operations-install-ubuntu.html)

### EC2 IAM 설정

Roles(역할)을 생성한다. IAM → roles → Create role 클릭

AWS servcie → EC2 → Next: Permissions 클릭

codedeploy 검색 → AWSCodeDeployFullAccess, AWSS3FullAccess 선택 → Next: Tags 클릭

Name tag 지정(나는 EC2-CodeDeploy라고 하였음)

Role name도 지정 후 적용한 내용이 맞는지 확인

### EC2에 생성한 역할 연결하기

EC2 Instance Dashboard로 이동

해당 instance 선택 후 Actions 클릭 → Instance Settings → Attach/Replace IAM Role 클릭

생성한 IAM role을 선택하고 Apply 클릭

### CodeDeploy IAM 설정

IAM → roles → Create role 클릭

AWS service → CodeDeploy → CodeDeploy Case 선택 → Next: Permissions 클릭

선택되어있는 role 그대로 진행

Name tag 지정(나는 CodeDeploy-EC2로 지정함)

Role name도 지정 후 적용한 내용이 맞는지 확인

### CodeDeploy 생성, 설정

CodeDeploy → Applications → Create applictaion

Application name 지정, Compute platform EC2/On-premises 선택

Create deployment group 클릭(배포 목적에 따른 구분) → service role 선택

Deployment type은 In-place로 지정

Environment는 Amazon EC2 Instances로 지정

 tag group을 지정해서 원하는 EC2 Instance를 추릴 수 있음

[CodeDeploy Deployment Settings](https://docs.aws.amazon.com/ko_kr/codedeploy/latest/userguide/deployment-configurations.html)

loadbalancer는 설정하지 않는다.

