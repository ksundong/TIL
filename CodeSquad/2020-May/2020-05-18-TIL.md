# 2020-05-18-TIL

## 내일 할 일

- [x] 팀 빌딩
- [ ] 페어프로그래밍
- [x] 학습한 내용 정리
- [x] 요구사항 분석
- [x] 코드스쿼드 수업

## 코드스쿼드 수업

- Hadoop(분산 파일 시스템)
  - Map Reduce
- LINE은 Redis를 사용해서 빠른 메시징, HBase는 하둡 기반의 무제한 확장이 가능한 분산 DB
- MySQL bulk insert
  - `load data local infile`을 사용한다.
- 성능 측정
  - 지정검색
  - 범위검색
  - count
  - 정렬
- 인덱스 생성 후 성능이 좋아질까?
  - `SHOW INDEX FROM user;`
  - 정렬 성능
  - 검색 성능
  - 무조건 성능
  - 오름차순 내림차순의 성능은 동일한가?
  - Selectivity란 무엇일까?
    - Selectivity와 인덱스
- 복합 인덱스 생성 및 성능 비교
  - 기존 인덱스 제거
  - 복합 인덱스 생성
    - 성능이 개선되었는가?

### 주기적으로 서버에 데이터를 넣는 작업

- 외부 업체에서 제공하는 csv 파일을 가지고 bulk insert하는 방법을 알아야 한다.
- `mysql -ueleven -peleven --local-infile test -e "LOAD DATA LOCAL INFILE 'hello.csv'  INTO TABLE user  FIELDS TERMINATED BY ',' LINES TERMINATED BY '\n'"`

### 범위 검색

Date 같은 것을 범위검색 하면 Full scan을 하게된다. 따라서 걸린 시간은 Full scan하는데 걸린 시간이다.

인덱스가 되어있는 경우 B-tree를 뒤지는건 0.01초 걸렸다는 의미

검색 성능을 높이기 위해서 인덱스를 사용할 수 있다.

인덱스를 아무렇게나 만든다고 무조건 성능이 좋아지지 않는다.

잘 만들어야 한다.

데이터의 분포에 따라서 인덱스의 성능이 달라지는데, 인덱스를 어떤 경우에 적용해야하는지 이해해야한다.

데이터의 분포에 따라 인덱스를 적용하는 경우 속도의 차이는 DB별로 다르다. (MySQL 검색결과가 10~20%정도일 때 적용하는걸 권장)

mysql은 통계 정보를 가지고 있어서, 어떤 경우에 인덱스를 적용해야할 지 똑똑하게 결정한다.

# 숙소 예약 서비스 요구사항 분석

## 검색 조건

- 기간 검색조건
    - 체크인
    - 체크아웃
    - 현재 날짜를 내려줘야 할까?
- 인원 검색조건
    - 최소 0명
    - 최대 8명
    - 성인 어린이 유아의 모든 합이 8명일듯
- 요금 검색조건
    - 최저 요금
    - 최고 요금
- 검색조건에 대한 Bean Validation 필요.
- 검색결과는 body 형태로 받음.
    - body 형태 정의가 필요할 듯

## 검색 결과

- 검색 완료 후 Count 쿼리 결과를 표시할 필요가 있음.
- 검색결과 없을 경우 전체 데이터
- 각 아이템의 API 형식을 미리 정의하자
    - 이미지(여러 개), 뱃지, 지역, 별점, 제목, 설명, 가격(할인 전, 할인 후) 1박, 기간 계산 가격(내려줘야할까?)

## 예약 화면

- 가격(할인 후), 별점, 후기, 기간 계산 가격, 청소비, 서비스 수수료, 숙박세와 수수료, 합계 가격

## 추가 요구 사항

- 위도 경도, 예약 취소 기능(예약을 저장해야 하는 듯)

## Infra

ec2 서브넷 db 서브넷 구분하기(웹서버, DB 분리)  
DB Port는 웹서버에만 개방  
GitHub Action을 이용한 배포(master 브랜치) (우선순위 높일 필요 있음)  
NginX 설정 필요.

## DB

최소한 DB 설계가 목요일 이전까지 끝나고, DB에 데이터를 Import 하기 위해 전체 Data를 파싱해서 저장해 둘 필요는 있음.

### 사용자

Admin 유저가 존재는 하지만 하드코딩으로 인증과정을 거침.  

1. 숙소 등록 권한 페이지
2. 숙소 등록 페이지
3. 숙소의 예약자 정보 보기

사용자는 OAuth 인증 말고도 고객 Data를 Randomize해서 구성할 필요도 있을 듯.

### 숙소

- 기간별로 데이터가 있어야 함.

## 오늘의 회고

맥북이 와서 신나서 세팅하는데 시간을 좀 쓴 것 같다.

전체적으로 집중을 하지 못한 감이 있어서, 오늘은 좀 일찍자고 내일 일찍 나와서 집중을 할 수 있도록 해 볼 생각이다.

내일은 마일스톤도 정해보자. (Phase 1, 2, 3에는 무엇이 들어갈지 고민을 해보자)

좋은 노트북으로 바꿨으니, 더 열심히 할 수 있도록 하자.

## 내일 할 일

- [ ] 마일스톤 정의하기
- [ ] DB 스키마 정하기
- [ ] Infra 구성하기
- [ ] 페어 프로그래밍

