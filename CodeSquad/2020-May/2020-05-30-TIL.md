# 2020-05-30-TIL

## 오늘 할 일

- [ ] 자료구조 스터디
- [ ] 페이징 기능
- [ ] MockData 추가
- [x] 테스트 코드 작성

## IntelliJ Test Live Template 만들기

![live-template](https://i.imgur.com/sUWpdYj.png)

![variables](https://i.imgur.com/5eCmpAi.png)

이렇게 해주면 실패하는 test method를 만들어 줄 수 있다.

그리고, BODY 부분만 수정해주면, assertJ로 변환도 가능하다.

```java
@org.junit.jupiter.api.Test
@org.junit.jupiter.api.DisplayName("$TEST_NAME$")
void $METHOD_NAME$() {
    $BODY$
}
```

Reformat according to style를 체크해주면, code style에 맞게 알아서 정렬이 된다.

## 테스트 코드 작성

### Spring Web Layer Testing Guide

https://spring.io/guides/gs/testing-web

### Spring MockMvc 한글 깨짐 문제 해결방법

[참고](https://stackoverflow.com/questions/58525387/mockmvc-no-longer-handles-utf-8-characters-with-spring-boot-2-2-0-release)

#### 방법 1

`Configuration`을 이용하는 방법

```java
@Configuration
public class SpringConfig implements WebMvcConfigurer {

    @Override
    public void configureMessageConverters(List<HttpMessageConverter<?>> converters) {
        converters.stream()
            .filter(converter -> converter instanceof MappingJackson2HttpMessageConverter)
            .findFirst()
            .ifPresent(converter -> ((MappingJackson2HttpMessageConverter) converter).setDefaultCharset(UTF_8));
    }
}
```

#### 방법 2

`BeforeEach`를 이용하는 방법

```java
  @Autowired
  private WebApplicationContext wac;

  // MockMvc가 한글 인코딩이 깨져서 발생하는 현상을 해결하기 위한 방법(2)
  @BeforeEach
  void setUp() {
    mockMvc = webAppContextSetup(wac).addFilter(((request, response, chain) -> {
      response.setCharacterEncoding("UTF-8");
      chain.doFilter(request, response);
    })).build();
  }
```

### MockHttpServletRequestBuilder에서 ModelAttribute 값 넘기기

```java
    MockHttpServletRequestBuilder requestBuilder = get("/rooms/search")
        .flashAttr("searchRequest", searchRequest)
        .contentType(MediaType.APPLICATION_JSON);
```

`flashAttr(name, value)` 를 이용하면 된다. 

### MockMvc를 이용할 때, RestAPI를 테스트 하려면

`MockHttpServletRequestBuilder`에서 contentType을 `MediaType.APPLICATION_JSON`으로 지정해주어야 한다.

### IntelliJ에서 json을 쉽게 작성하는 방법

맥 기준으로 `option` + `enter` 를 입력하면 **inject language or reference**라는 메뉴를 눌러서 JSON으로 바꾸어준다. 그 다음 `option` + `enter`를 눌러서 `Edit JsonFragement`를 선택해준다.

### Hamcrest null Matcher 작성방법

`nullValue()`를 사용하면 된다.

